<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>テレビ用 気象情報</title>
<style>
body{
  margin:0;
  background:#0b1a33;
  color:#fff;
  font-family:"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
}
#container{
  width:100vw;
  height:100vh;
  padding:20px;
  box-sizing:border-box;
}
#header{
  font-size:32px;
  font-weight:bold;
  border-bottom:3px solid #4da3ff;
  margin-bottom:10px;
}
#select{
  font-size:18px;
  margin-bottom:10px;
}
#main{
  display:flex;
}
#info{
  width:40%;
  font-size:24px;
}
#info div{
  margin-bottom:10px;
}
#script{
  width:60%;
  font-size:20px;
  background:rgba(255,255,255,0.1);
  padding:15px;
  white-space:pre-wrap;
}
</style>
</head>
<body>

<div id="container">
  <div id="header">気 象 情 報</div>

  <select id="select">
    <option value="130000">東京都</option>
    <option value="140000">神奈川県</option>
    <option value="120000">千葉県</option>
    <option value="110000">埼玉県</option>
  </select>

  <div id="main">
    <div id="info">
      <div id="area">---</div>
      <div id="weather">---</div>
      <div id="temp">---</div>
      <div id="pop">---</div>
    </div>
    <div id="script">読み込み中…</div>
  </div>
</div>

<script>
const select = document.getElementById("select");

select.addEventListener("change", () => {
  loadWeather(select.value);
});

loadWeather(select.value);

function loadWeather(code){
  fetch(`https://www.jma.go.jp/bosai/forecast/data/forecast/${code}.json`)
  .then(res => res.json())
  .then(data => {

    const areaName = data[0].timeSeries[0].areas[0].area.name;
    const weather = data[0].timeSeries[0].areas[0].weathers[0];
    const pops = data[0].timeSeries[1].areas[0].pops;
    const temps = data[1].timeSeries[1].areas[0].temps;

    document.getElementById("area").innerText = areaName;
    document.getElementById("weather").innerText = "天気：" + weather;
    document.getElementById("temp").innerText =
      `気温：最低 ${temps[0]}℃ / 最高 ${temps[1]}℃`;
    document.getElementById("pop").innerText =
      `降水確率：${pops[0]}〜${pops[1]}％`;

    const script = `
画面をご覧ください。

今日の${areaName}の天気です。
${areaName}は「${weather}」となるでしょう。

最高気温は${temps[1]}度、
最低気温は${temps[0]}度の予想です。

降水確率は最大で${Math.max(...pops)}％です。
お出かけの際は折りたたみ傘があると安心です。

以上、気象情報でした。
`;

    document.getElementById("script").innerText = script;
  })
  .catch(err=>{
    document.getElementById("script").innerText =
      "通信エラー。GitHub Pagesで開いてください。";
  });
}
</script>

</body>
</html>
